<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aesthetic 50-Question Science Quiz</title>
<!-- Load Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Load Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* Basic setup and global styles */
body {
    font-family: 'Inter', sans-serif;
    /* Soft gradient background for aesthetic appeal */
    background: #e2e8f0; /* bg-slate-200 equivalent */
}

/* Ensure the quiz container itself is responsive and centered */
.quiz-container {
    max-width: 800px; 
    margin: auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 1.5rem 1rem; /* Padding for mobile */
}
@media (min-width: 640px) {
    .quiz-container {
        padding: 2rem; /* More padding on desktop */
    }
}

/* --- ANIMATION & CUSTOM BUTTON STYLES --- */

/* Base transition for all interactive elements */
#start-quiz-button, #prev-button, #next-button, .option-button {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateZ(0); 
}

/* Press-down/click animation for the main action buttons */
#start-quiz-button:active:not(:disabled),
#next-button:active:not(:disabled) {
    transform: scale(0.98);
    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); 
}

#prev-button:active:not(:disabled) {
    transform: scale(0.98);
}


/* Enhanced Option Button Styles (for the quiz choices) */
.option-button {
    cursor: pointer;
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.05); /* Soft shadow */
    white-space: normal;
}

/* Subtle lift and shadow on hover */
.option-button:hover:not(.disabled):not(.correct):not(.incorrect) {
    background-color: #f7f8fa; /* Very subtle hover */
    transform: translateY(-1px); 
    box-shadow: 0 6px 10px -2px rgba(0, 0, 0, 0.1); 
    border-color: #6366f1; /* Indigo border on hover */
}

/* Subtle press effect */
.option-button:active:not(.disabled):not(.correct):not(.incorrect) {
    transform: scale(0.99); 
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); 
    background-color: #eff1f5; 
}

/* Visual feedback for correct/incorrect answers */
.correct {
    background-color: #10b981 !important; /* Emerald 500 */
    color: white !important;
    border-color: #059669 !important; /* Emerald 600 */
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(16, 185, 129, 0.5); /* Glowing effect */
}
.incorrect {
    background-color: #ef4444 !important; /* Red 500 */
    color: white !important;
    border-color: #dc2626 !important; /* Red 600 */
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(239, 68, 68, 0.5); /* Glowing effect */
}
.disabled {
    pointer-events: none;
    opacity: 0.9; 
    box-shadow: none !important;
}

/* Hide the main quiz content initially */
#main-quiz-container {
    display: none;
}
</style>
</head>
<body>

<div class="quiz-container">

<!-- WELCOME SCREEN -->
<div id="welcome-screen" class="bg-white p-8 sm:p-12 shadow-2xl rounded-3xl flex-grow flex flex-col justify-center items-center text-center transform transition-all duration-500 hover:shadow-3xl">
    <h1 class="text-4xl sm:text-6xl font-black text-indigo-700 mb-6 tracking-tight">üî¨ Science Quiz Challenge</h1>
    
    <div class="space-y-4 text-gray-700 max-w-md mx-auto mb-12 p-6 bg-indigo-50 rounded-2xl border-4 border-indigo-200">
        <p class="text-xl sm:text-2xl font-bold flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 mr-3" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 9.586V6z" clip-rule="evenodd" />
            </svg>
            <span class="text-indigo-600">50 Questions</span> await.
        </p>
        <p class="text-xl sm:text-2xl font-bold flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-3" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 9.586V6z" clip-rule="evenodd" />
            </svg>
            Time Limit: <span class="text-red-500 font-extrabold ml-1">50 Minutes</span>
        </p>
        <p class="text-md sm:text-lg font-medium pt-2 text-gray-600">Prepare yourself and good luck!</p>
    </div>

    <button id="start-quiz-button" class="px-12 py-4 sm:px-16 sm:py-5 bg-emerald-600 text-white text-xl sm:text-2xl font-bold rounded-xl shadow-xl hover:bg-emerald-700 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] focus:ring-4 focus:ring-emerald-300">
        Start Quiz
    </button>
    
    <footer class="text-xs text-gray-400 mt-10">
        Quiz content based on a 50-question science syllabus.
    </footer>
</div>

<!-- MAIN QUIZ CONTENT (Hidden until started) -->
<div id="main-quiz-container" class="flex flex-col flex-grow">

    <!-- Header (Title and Timer) -->
    <header class="text-center py-4 mb-6 bg-white shadow-xl rounded-2xl flex flex-col sm:flex-row justify-between items-center px-4 sm:px-8 border-b-4 border-indigo-500">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-800 mb-2 sm:mb-0">Science Mastery</h1>
        <div class="flex items-center space-x-3 p-2 rounded-lg bg-red-50 border border-red-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="timer-display" class="text-2xl sm:text-3xl font-black text-red-600">50:00</span>
        </div>
    </header>

    <!-- Progress Bar and Stats -->
    <div class="flex justify-between text-base sm:text-lg font-semibold text-gray-600 mb-2 px-2">
        <span id="question-index">Question 1 of 50</span>
        <span id="score-display" class="text-indigo-600">Score: 0</span>
    </div>
    <div id="progress-bar" class="w-full bg-gray-300 rounded-full h-3 mb-8 overflow-hidden">
        <div id="progress-fill" class="bg-indigo-600 h-3 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
    </div>

    <!-- Quiz Area -->
    <main id="quiz-area" class="bg-white p-6 sm:p-8 shadow-2xl rounded-3xl flex-grow border border-gray-100">
        <div class="text-center py-10"><p class="text-gray-500">Initializing quiz...</p></div>
    </main>

    <!-- Navigation Buttons -->
    <div id="navigation-area" class="mt-6 p-5 bg-white shadow-2xl rounded-2xl flex flex-col sm:flex-row justify-between gap-4 border-t-4 border-gray-200">
        <button id="prev-button" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-bold transition-colors hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
        <button id="next-button" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold transition-colors hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed">Next Question</button>
    </div>
</div>

</div>

<script>
// --- QUIZ DATA (50 Questions) ---
const quizData = [
// Chapter 4: Reproduction in Plants (8 Qs)
{ q: "Which part of a seed is responsible for developing into the shoot of the new plant?", options: ["Radicle", "Plumule", "Cotyledon", "Seed coat"], correct: "Plumule" },
{ q: "Which of the following is an example of an underground modified stem that helps in vegetative reproduction?", options: ["Sweet potato", "Ginger (Rhizome)", "Onion (Bulb)", "Dahlia (Tuber)"], correct: "Ginger (Rhizome)" },
{ q: "What is the process of joining parts of two plants so they grow as one known as?", options: ["Cutting", "Layering", "Budding", "Grafting"], correct: "Grafting" },
{ q: "Which fruit is cited as developing only from the ovary and thus classified as a 'true fruit'?", options: ["Apple", "Custard apple", "Mango", "Jackfruit"], correct: "Mango" },
{ q: "The essential whorls of a flower are the androecium and which other part?", options: ["Calyx", "Corolla", "Gynoecium (Pistil)", "Receptacle"], correct: "Gynoecium (Pistil)" },
{ q: "What is the term for the type of germination where the cotyledons remain under the soil (e.g., Gram)?", options: ["Epigeal", "Hypogeal", "Semi-epigeal", "Aerial"], correct: "Hypogeal" },
{ q: "The gaseous phytohormone primarily responsible for fruit ripening is:", options: ["Auxin", "Gibberellin", "Cytokinin", "Ethylene"], correct: "Ethylene" },
{ q: "The movement of a plant part towards the direction of light is called:", options: ["Geotropism", "Hydrotropism", "Phototropism", "Thigmotropism"], correct: "Phototropism" },

// Chapter 5: Co-ordination and Secretion (8 Qs)
{ q: "The structural and functional unit of the nervous system is the:", options: ["Nephron", "Alveolus", "Neurone (Nerve cell)", "Myofibril"], correct: "Neurone (Nerve cell)" },
{ q: "The plant hormone first discovered by Charles Darwin is:", options: ["Gibberellin", "Auxin", "Cytokinin", "Abscisic Acid"], correct: "Auxin" },
{ q: "What is the term for the minute gap or junction between the axon end of one neurone and the dendrite of the next?", options: ["Cell body", "Dendrite", "Node of Ranvier", "Synapse"], correct: "Synapse" },
{ q: "Which part of the human brain controls vital involuntary actions such as breathing and heartbeat?", options: ["Cerebrum", "Cerebellum", "Pons", "Medulla oblongata"], correct: "Medulla oblongata" },
{ q: "What is the primary function controlled by the largest part of the brain, the Cerebrum?", options: ["Balancing body posture", "Controlling heart rate", "Thinking, memory, vision", "Regulating sleep cycles"], correct: "Thinking, memory, vision" },
{ q: "Which organ is cited as the **main** excretory organ, eliminating about 80% of nitrogenous waste?", options: ["Lung", "Skin", "Kidney", "Liver"], correct: "Kidney" },
{ q: "The nitrogenous waste product eliminated by the kidney as the primary component of urine is:", options: ["Urea", "Carbon dioxide", "Salt", "Sweat"], correct: "Urea" },
{ q: "What is a chemical compound that regulates physiological activities in plants called?", options: ["Enzyme", "Vitamin", "Phytohormone", "Toxin"], correct: "Phytohormone" },

// Chapter 10: Acid, Base and Salt (9 Qs)
{ q: "Which ion must an acidic substance produce when dissolved in water?", options: ["Hydroxide ion ($\text{OH}^-$)", "Sodium ion ($\text{Na}^+$)", "Sulphate ion ($\text{SO}_4^{2-}$)", "Hydrogen ion ($\text{H}^+$)"], correct: "Hydrogen ion ($\text{H}^+$)" },
{ q: "A characteristic property of a base is that it turns:", options: ["Blue litmus paper red", "Red litmus paper blue", "Phynophthylene colorless", "Methyl orange red"], correct: "Red litmus paper blue" },
{ q: "What is the definition of an **alkali** according to the document?", options: ["A base that is concentrated", "A base that dissolves in water", "A weak organic base", "Any substance that tastes bitter"], correct: "A base that dissolves in water" },
{ q: "Which gas is produced when a reactive metal like Zinc ($\text{Zn}$) reacts with Sulphuric Acid ($\text{H}_2\text{SO}_4$)?", options: ["Oxygen ($\text{O}_2$)", "Carbon Dioxide ($\text{CO}_2$)", "Sulphur Dioxide ($\text{SO}_2$)", "Hydrogen ($\text{H}_2$)"], correct: "Hydrogen ($\text{H}_2$)" },
{ q: "The reaction between Calcium Hydroxide ($\text{Ca}(\text{OH})_2$) and Sulphuric Acid ($\text{H}_2\text{SO}_4$) primarily produces salt and:", options: ["Metal", "Gas", "Acid", "Water"], correct: "Water" },
{ q: "Which of the following common substances is an example of an **organic acid**?", options: ["Sulphuric acid", "Hydrochloric acid", "Citric acid (in lemon)", "Nitric acid"], correct: "Citric acid (in lemon)" },
{ q: "The reaction between an acid and a carbonate ($\text{CaCO}_3$) produces salt, water, and which gas?", options: ["Oxygen", "Carbon Dioxide", "Hydrogen", "Nitrogen"], correct: "Carbon Dioxide" },
{ q: "If a base is added to an indicator called **Phynophthylene**, the color changes to:", options: ["Blue", "Red", "Pink/Reddish Purple", "Green"], correct: "Pink/Reddish Purple" },
{ q: "Mineral acids are generally considered more harmful than organic acids because:", options: ["They contain carbon", "They are insoluble in water", "They are highly corrosive and strong", "They are found only in minerals"], correct: "They are highly corrosive and strong" },

// Chapter 11: Light (9 Qs)
{ q: "What phenomenon explains why a pencil partially submerged in water appears broken or bent?", options: ["Total Internal Reflection", "Dispersion", "Refraction of light", "Diffraction"], correct: "Refraction of light" },
{ q: "When light passes from an optically **denser** medium to a **rarer** medium, the light ray bends:", options: ["Towards the normal", "Away from the normal", "Parallel to the surface", "Without bending"], correct: "Away from the normal" },
{ q: "The critical angle is the angle of incidence at which the angle of refraction is exactly:", options: ["45 degrees", "90 degrees", "180 degrees", "0 degrees"], correct: "90 degrees" },
{ q: "Which principle is utilized in the transmission of signals through **Optical Fibre**?", options: ["Refraction only", "Reflection only", "Total Internal Reflection (TIR)", "Polarization"], correct: "Total Internal Reflection (TIR)" },
{ q: "A simple magnifying glass uses which type of lens to form a virtual, upright, and magnified image?", options: ["Concave lens", "Plano-concave lens", "Concave mirror", "Convex lens"], correct: "Convex lens" },
{ q: "The image formed on the **retina** of a normal human eye is always:", options: ["Virtual, upright, magnified", "Real, upright, reduced", "Real, inverted, reduced", "Virtual, inverted, magnified"], correct: "Real, inverted, reduced" },
{ q: "For Total Internal Reflection to occur, light must travel from which combination of media?", options: ["Rarer to Denser", "Denser to Rarer", "Vacuum to Air", "Same density media"], correct: "Denser to Rarer" },
{ q: "When light undergoes refraction, which property is primarily responsible for the bending of the light ray?", options: ["Change in color", "Change in speed", "Change in frequency", "Change in amplitude"], correct: "Change in speed" },
{ q: "In the context of the human eye, which part functions analogously to the aperture of a camera?", options: ["Retina", "Lens", "Iris", "Optic nerve"], correct: "Iris" },

// Chapter 12: The Outer Space and Satellites (8 Qs)
{ q: "According to the Big Bang theory, approximately how many years ago did the universe begin?", options: ["4.5 billion years", "13.75 billion years", "25 billion years", "100 million years"], correct: "13.75 billion years" },
{ q: "The Outer Space is considered to begin at an altitude of about how many kilometers above the Earth's surface?", options: ["10 km", "60 km", "160 km", "500 km"], correct: "160 km" },
{ q: "What is the minimum speed required for an artificial satellite to maintain orbit around the Earth (approximately)?", options: ["1 km/s", "8 km/s", "15 km/s", "25 km/s"], correct: "8 km/s" },
{ q: "The stability of an orbiting satellite is a balance between its centrifugal acceleration and which other force?", options: ["Electromagnetic force", "Air resistance", "Gravitational force", "Thrust"], correct: "Gravitational force" },
{ q: "How many major planets revolve around the Sun in our Solar System?", options: ["7", "8", "9", "10"], correct: "8" },
{ q: "What was the name of the first artificial satellite launched into space?", options: ["Vostok 1", "Explorer 1", "Sputnik 1", "Venera 7"], correct: "Sputnik 1" },
{ q: "A primary example of a **natural satellite** is:", options: ["Jupiter", "The Moon", "Asteroid belt", "The Sun"], correct: "The Moon" },
{ q: "A satellite designed to stay positioned over the same spot on Earth's equator is best used for:", options: ["Weather forecasting", "Earth observation", "Deep space exploration", "Communication and broadcasting"], correct: "Communication and broadcasting" },

// Chapter 14: Environment and Ecosystem (8 Qs)
{ q: "In an ecosystem, which component is responsible for manufacturing food using solar energy?", options: ["Primary Consumers", "Secondary Consumers", "Decomposers", "Producers (Green Plants)"], correct: "Producers (Green Plants)" },
{ q: "What term describes the flow of **energy** through an ecosystem?", options: ["Cyclic", "Circular", "Linear (one-way)", "Biogeochemical"], correct: "Linear (one-way)" },
{ q: "Which organisms are classified as **Decomposers** in an ecosystem?", options: ["Herbivores and Carnivores", "Green plants and algae", "Fungi and Bacteria", "Snakes and Eagles"], correct: "Fungi and Bacteria" },
{ q: "A complex network formed by the interconnection of numerous food chains is called a:", options: ["Biogeochemical cycle", "Energy pyramid", "Food Web", "Biotope"], correct: "Food Web" },
{ q: "An organism that feeds directly on a Primary Consumer is classified as a:", options: ["Producer", "Tertiary Consumer", "Secondary Consumer", "Herbivore"], correct: "Secondary Consumer" },
{ q: "Which of the following is considered an **abiotic** component of an ecosystem?", options: ["Bacteria", "Minerals (Soil/Water)", "Fungi", "Insects"], correct: "Minerals (Soil/Water)" },
{ q: "The movement of **nutritive substances** (matter) through an ecosystem is best described as:", options: ["Linear", "Explosive", "Exponential", "Circular"], correct: "Circular" },
{ q: "What is the entire self-regulating system of biotic and abiotic components in a specific environment called?", options: ["Biome", "Biosphere", "Population", "Ecosystem"], correct: "Ecosystem" }
];

// --- STATE VARIABLES ---
let currentQuestionIndex = 0;
let score = 0;
// Initialize userAnswers with null for all 50 questions
const userAnswers = new Array(quizData.length).fill(null);
let isReviewMode = false;
let timerInterval;
// 50 minutes * 60 seconds/minute = 3000 seconds
let timeLeft = 50 * 60; 

// --- DOM REFERENCES ---
const welcomeScreen = document.getElementById('welcome-screen');
const mainQuizContainer = document.getElementById('main-quiz-container');
const quizArea = document.getElementById('quiz-area');
const questionIndexEl = document.getElementById('question-index');
const scoreDisplayEl = document.getElementById('score-display');
const prevButton = document.getElementById('prev-button');
const nextButton = document.getElementById('next-button');
const progressBarFill = document.getElementById('progress-fill');
const timerDisplay = document.getElementById('timer-display');


// --- TIMER FUNCTIONS ---

/**
 * Formats time from seconds into MM:SS string.
 * @param {number} seconds - The time remaining in seconds.
 * @returns {string} Formatted time string.
 */
function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    const paddedMinutes = String(minutes).padStart(2, '0');
    const paddedSeconds = String(remainingSeconds).padStart(2, '0');
    return `${paddedMinutes}:${paddedSeconds}`;
}

/**
 * Decrements the timer and handles expiration.
 */
function updateTimer() {
    timeLeft--;
    timerDisplay.textContent = formatTime(timeLeft);

    // Dynamic styling for low time remaining
    if (timeLeft <= 300 && !timerDisplay.classList.contains('text-red-700')) { 
        timerDisplay.classList.add('text-red-700', 'font-extrabold', 'animate-pulse');
        timerDisplay.classList.remove('text-red-600', 'font-black');
    }

    if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timeExpired();
    }
}

/**
 * Starts the quiz timer. Clears any existing interval first.
 */
function startTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    timerDisplay.textContent = formatTime(timeLeft); // Initial display
    timerInterval = setInterval(updateTimer, 1000);
}

/**
 * Handles the event when the quiz time runs out.
 */
function timeExpired() {
    clearInterval(timerInterval); // Stop timer
    showMessage("Time's Up! ‚è±Ô∏è", "The 50 minutes have expired. Your quiz has been automatically submitted to calculate your score.");
    // Force show results
    showResults(true);
}


// --- QUIZ NAVIGATION & LOGIC ---

/**
 * Initiates the quiz, hiding the welcome screen and starting the timer.
 */
function startQuiz() {
    welcomeScreen.style.display = 'none';
    mainQuizContainer.style.display = 'flex'; 
    startTimer(); 
    renderQuestion();
}

/**
 * Shows a custom, non-blocking modal message instead of alert().
 * @param {string} title - The modal title.
 * @param {string} message - The modal message content.
 */
function showMessage(title, message) {
    // Pause timer
    if (!isReviewMode) {
        clearInterval(timerInterval); 
    }
    
    const messageBox = document.createElement('div');
    messageBox.className = 'fixed inset-0 bg-gray-900 bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50 p-4';
    messageBox.innerHTML = `
    <div class="bg-white p-8 rounded-2xl shadow-3xl max-w-sm w-full transform transition-all duration-300 scale-100 border-t-4 border-indigo-600">
        <h3 class="text-2xl font-black mb-4 text-indigo-700">${title}</h3>
        <p class="text-gray-700 mb-6">${message}</p>
        <button onclick="closeMessage()" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors shadow-lg">
            I Understand
        </button>
    </div>
    `;
    document.body.appendChild(messageBox);
}

/**
 * Closes the custom modal and resumes the timer if in quiz mode.
 */
function closeMessage() {
    const messageBox = document.querySelector('.fixed.inset-0');
    if (messageBox) {
        messageBox.remove();
    }
    // Resume timer only if in quiz mode and the quiz is still running (not results screen)
    if (mainQuizContainer.style.display !== 'none' && !isReviewMode && timeLeft > 0) {
        startTimer(); 
    }
}


/**
 * Renders the current question and its options. Handles displaying answers in review mode.
 */
function renderQuestion() {
    const questionData = quizData[currentQuestionIndex];
    const userAnswer = userAnswers[currentQuestionIndex];

    if (!questionData) {
        quizArea.innerHTML = `<div class="text-center py-10"><p class="text-gray-500">Error loading question.</p></div>`;
        return;
    }

    // Update progress and navigation UI elements
    updateProgress();
    updateNavigationButtons(); 

    // Build the HTML content for the question
    let htmlContent = `
    <p class="text-xl sm:text-2xl font-extrabold mb-8 text-gray-800 leading-snug">
    <span class="text-indigo-600">${currentQuestionIndex + 1}.</span> ${questionData.q}
    </p>
    <div class="space-y-4">
    `;

    const optionLabels = ['A', 'B', 'C', 'D'];

    questionData.options.forEach((option, index) => {
        let classes = "option-button w-full text-left p-4 border-2 border-gray-300 rounded-xl font-medium text-gray-700";
        let onClick = `selectOption('${option.replace(/'/g, "\\'")}')`; // Sanitize option string for inline JS

        const isAnsweredOrReview = userAnswer !== null || isReviewMode;

        // Check if user has answered this question or is in review mode
        if (isAnsweredOrReview) {
            // Disable clicking
            onClick = '';
            classes += ' disabled';

            // Highlight correct/incorrect logic
            if (userAnswer === option) {
                if (option === questionData.correct) {
                    classes += ' correct';
                } else {
                    classes += ' incorrect';
                }
            } else if (option === questionData.correct) {
                // Always highlight the correct answer in review or once answered incorrectly
                classes += ' correct';
            }

        } else {
            // Unanswered, not in review: Default styling
            classes += ' hover:bg-indigo-50/50';
        }

        htmlContent += `
        <button
        class="${classes}"
        data-option="${option}"
        onclick="${onClick}"
        >
        <span class="font-bold mr-2 ${isAnsweredOrReview ? '' : 'text-indigo-600'}">${optionLabels[index]}.</span> ${option}
        </button>
        `;
    });

    htmlContent += `</div>`;

    // Show detailed feedback if in review mode
    if (isReviewMode) {
        const isCorrect = userAnswer === questionData.correct;
        const feedbackClass = isCorrect ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-red-500 bg-red-50 text-red-700';

        htmlContent += `
        <div class="mt-8 p-6 rounded-xl border-l-4 shadow-md ${feedbackClass}">
        <p class="font-bold text-lg mb-1">
        ${isCorrect ? '‚úÖ Your Answer Was Correct!' : '‚ùå Your Answer Was Incorrect.'}
        </p>
        <p class="text-sm mt-2 text-gray-600">
        ${userAnswer ? `You chose: <span class="font-semibold text-gray-800">${userAnswer}</span>` : 'You left this question unanswered.'}
        </p>
        ${!isCorrect ? `<p class="text-sm mt-1 text-gray-600">The correct answer is: <span class="font-bold text-emerald-600">${questionData.correct}</span></p>` : ''}
        </div>
        `;
    }

    quizArea.innerHTML = htmlContent;
}

/**
 * Handles option selection and locks the question.
 * @param {string} selectedOption - The option text selected by the user.
 */
function selectOption(selectedOption) {
    // Only allow selection if not already answered and not in review mode
    if (userAnswers[currentQuestionIndex] === null && !isReviewMode) {
        userAnswers[currentQuestionIndex] = selectedOption;

        recalculateScore();
        renderQuestion();
        updateNavigationButtons();
    }
}

/**
 * Recalculates the score based on userAnswers vs quizData.
 */
function recalculateScore() {
    score = 0;
    quizData.forEach((question, index) => {
        if (userAnswers[index] === question.correct) {
            score++;
        }
    });
    scoreDisplayEl.textContent = `Score: ${score}`;
}

/**
 * Updates score display, question index, and the progress bar.
 */
function updateProgress() {
    const totalQuestions = quizData.length;
    const answeredQuestions = userAnswers.filter(a => a !== null).length;

    questionIndexEl.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;

    // Progress bar fills based on answered questions (quiz mode) or current index (review mode)
    const progressBasis = isReviewMode ? currentQuestionIndex + 1 : answeredQuestions;
    const progressPercentage = (progressBasis / totalQuestions) * 100;
    progressBarFill.style.width = `${progressPercentage}%`;
}

/**
 * Updates the state (disabled/text) of the navigation buttons.
 */
function updateNavigationButtons() {
    // Prev Button Logic
    prevButton.disabled = currentQuestionIndex === 0;
    
    if (isReviewMode) {
        nextButton.textContent = currentQuestionIndex === quizData.length - 1 ? 'End Review' : 'Next Question ‚Üí';
        prevButton.textContent = '‚Üê Previous Question'; 
        nextButton.disabled = false;
    } else {
        prevButton.textContent = '‚Üê Previous'; 
        nextButton.textContent = currentQuestionIndex === quizData.length - 1 ? 'Finish & See Results' : 'Next Question ‚Üí';
        // Disable 'Next' if not answered and not the last question
        nextButton.disabled = userAnswers[currentQuestionIndex] === null && currentQuestionIndex < quizData.length - 1;
    }
}

/**
 * Handles the "Next" button click, advancing the question or finishing the quiz/review.
 */
function handleNext() {
    if (currentQuestionIndex < quizData.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
    } else {
        // End of the list of questions
        if (isReviewMode) {
            // End of review mode
            isReviewMode = false;
            showResults();
        } else {
            // End of quiz mode
            showResults();
        }
    }
}

/**
 * Handles the "Previous" button click, moving back one question.
 */
function handlePrev() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
    }
}

/**
 * Generates and displays the final results screen.
 * @param {boolean} [timeExpired=false] - True if the submission was forced by the timer.
 */
function showResults(timeExpired = false) {
    clearInterval(timerInterval); // Stop timer
    recalculateScore();
    const totalQuestions = quizData.length;
    const percentage = ((score / totalQuestions) * 100).toFixed(1);
    const answeredCount = userAnswers.filter(a => a !== null).length;
    const unansweredCount = totalQuestions - answeredCount;

    let resultMessage;
    let resultColor;
    let icon;

    if (percentage >= 80) {
        resultMessage = "Outstanding! You have an excellent grasp of the material.";
        resultColor = 'text-emerald-700 bg-emerald-100 border-emerald-400';
        icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-emerald-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
    } else if (percentage >= 60) {
        resultMessage = "Great job! You passed, but review the topics you missed.";
        resultColor = 'text-yellow-700 bg-yellow-100 border-yellow-400';
        icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.332 16c-.77 1.333.192 3 1.732 3z" /></svg>`;
    } else {
        resultMessage = "Keep studying! Review the course material and try again.";
        resultColor = 'text-red-700 bg-red-100 border-red-400';
        icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-red-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
    }

    quizArea.innerHTML = `
    <div class="text-center py-10">
    <h2 class="text-4xl sm:text-5xl font-extrabold text-indigo-600 mb-2">${timeExpired ? 'Submission Forced!' : 'Quiz Complete!'}</h2>
    <p class="text-xl text-gray-500 mb-8">${answeredCount} questions were answered out of ${totalQuestions}.</p>
    
    <div class="inline-block p-10 rounded-full border-4 ${resultColor} shadow-xl mb-8">
        ${icon}
        <p class="text-5xl sm:text-7xl font-black mt-2">${percentage}%</p>
    </div>

    <p class="text-xl mt-6 text-gray-700 font-semibold">${resultMessage}</p>

    <!-- Detailed Stats Grid -->
    <div class="grid grid-cols-3 gap-4 mt-10 text-md font-bold max-w-lg mx-auto">
    <div class="p-4 bg-emerald-50 rounded-xl text-emerald-800 border border-emerald-200 shadow-md">
    <p class="font-black text-3xl">${score}</p>
    <p class="mt-1">Correct</p>
    </div>
    <div class="p-4 bg-red-50 rounded-xl text-red-800 border border-red-200 shadow-md">
    <p class="font-black text-3xl">${totalQuestions - score}</p>
    <p class="mt-1">Incorrect</p>
    </div>
    <div class="p-4 bg-gray-50 rounded-xl text-gray-800 border border-gray-200 shadow-md">
    <p class="font-black text-3xl">${unansweredCount}</p>
    <p class="mt-1">Skipped</p>
    </div>
    </div>

    </div>
    `;

    // Update navigation for results screen
    prevButton.textContent = 'Review Answers';
    prevButton.disabled = false;
    nextButton.textContent = 'Start New Quiz';
    nextButton.disabled = false;

    // Update progress bar to 100% completion
    progressBarFill.style.width = '100%';

    // Reassign click handlers for results buttons
    prevButton.onclick = startReview;
    nextButton.onclick = resetQuiz;
}

/**
 * Initiates the review mode to allow users to see correct answers.
 */
function startReview() {
    isReviewMode = true;
    currentQuestionIndex = 0;
    
    // Set the navigation handlers back to handlePrev/handleNext for question navigation
    prevButton.onclick = handlePrev;
    nextButton.onclick = handleNext;
    
    // Hide timer in review mode
    const timerParent = document.getElementById('timer-display').parentNode;
    if (timerParent) timerParent.style.display = 'none';
    
    renderQuestion();
}

/**
 * Resets the entire quiz state and returns to the welcome screen.
 */
function resetQuiz() {
    clearInterval(timerInterval); 
    
    // Reset state
    currentQuestionIndex = 0;
    score = 0;
    userAnswers.fill(null);
    isReviewMode = false;
    timeLeft = 50 * 60; 

    // Reset timer display state if it was red
    timerDisplay.classList.remove('text-red-700', 'font-extrabold', 'animate-pulse');
    timerDisplay.classList.add('text-red-600', 'font-black');
    
    // Reset UI to welcome screen
    mainQuizContainer.style.display = 'none';
    welcomeScreen.style.display = 'flex';
    
    // Show timer again
    const timerParent = document.getElementById('timer-display').parentNode;
    if (timerParent) timerParent.style.display = 'flex';
    
    // Re-attach original handlers
    prevButton.onclick = handlePrev;
    nextButton.onclick = handleNext;
    
    // Reset button text to default 
    prevButton.textContent = '‚Üê Previous';
    nextButton.textContent = 'Next Question ‚Üí';
}

// --- EVENT LISTENERS (Standard Quiz Navigation) ---
// These are the default handlers used during the main quiz flow
nextButton.addEventListener('click', handleNext);
prevButton.addEventListener('click', handlePrev);
// The welcome screen button uses an inline onclick="startQuiz()" for simplicity


// --- INITIALIZATION ---
// No action required as the welcome screen is visible by default.
</script>

</body>
</html>