<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ICT Network & Security Quiz</title>
<!-- Load Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Load Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* Basic setup and global styles */
body {
    font-family: 'Inter', sans-serif;
    /* Soft gradient background for aesthetic appeal */
    background: #e2e8f0; /* bg-slate-200 equivalent */
}

/* Ensure the quiz container itself is responsive and centered */
.quiz-container {
    max-width: 800px; 
    margin: auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 1.5rem 1rem; /* Padding for mobile */
}
@media (min-width: 640px) {
    .quiz-container {
        padding: 2rem; /* More padding on desktop */
    }
}

/* --- ANIMATION & CUSTOM BUTTON STYLES --- */

/* Base transition for all interactive elements */
#start-quiz-button, #prev-button, #next-button, .option-button {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateZ(0); 
}

/* Press-down/click animation for the main action buttons */
#start-quiz-button:active:not(:disabled),
#next-button:active:not(:disabled) {
    transform: scale(0.98);
    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); 
}

#prev-button:active:not(:disabled) {
    transform: scale(0.98);
}


/* Enhanced Option Button Styles (for the quiz choices) */
.option-button {
    cursor: pointer;
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.05); /* Soft shadow */
    white-space: normal;
}

/* Subtle lift and shadow on hover */
.option-button:hover:not(.disabled):not(.correct):not(.incorrect) {
    background-color: #f7f8fa; /* Very subtle hover */
    transform: translateY(-1px); 
    box-shadow: 0 6px 10px -2px rgba(0, 0, 0, 0.1); 
    border-color: #6366f1; /* Indigo border on hover */
}

/* Subtle press effect */
.option-button:active:not(.disabled):not(.correct):not(.incorrect) {
    transform: scale(0.99); 
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); 
    background-color: #eff1f5; 
}

/* Visual feedback for correct/incorrect answers */
.correct {
    background-color: #10b981 !important; /* Emerald 500 */
    color: white !important;
    border-color: #059669 !important; /* Emerald 600 */
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(16, 185, 129, 0.5); /* Glowing effect */
}
.incorrect {
    background-color: #ef4444 !important; /* Red 500 */
    color: white !important;
    border-color: #dc2626 !important; /* Red 600 */
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(239, 68, 68, 0.5); /* Glowing effect */
}
.disabled {
    pointer-events: none;
    opacity: 0.9; 
    box-shadow: none !important;
}

/* Hide the main quiz content initially */
#main-quiz-container {
    display: none;
}
</style>
</head>
<body>

<div class="quiz-container">

<!-- WELCOME SCREEN -->
<div id="welcome-screen" class="bg-white p-8 sm:p-12 shadow-2xl rounded-3xl flex-grow flex flex-col justify-center items-center text-center transform transition-all duration-500 hover:shadow-3xl">
    <!-- MODIFICATION: Updated Title to "ICT Quiz" -->
    <h1 class="text-4xl sm:text-6xl font-black text-indigo-700 mb-6 tracking-tight">ICT Quiz</h1>
    
    <div class="space-y-4 text-gray-700 max-w-md mx-auto mb-12 p-6 bg-indigo-50 rounded-2xl border-4 border-indigo-200">
        <p class="text-xl sm:text-2xl font-bold flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 mr-3" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 9.586V6z" clip-rule="evenodd" />
            </svg>
            <span class="text-indigo-600">40 Questions</span>
        </p>
        <p class="text-xl sm:text-2xl font-bold flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-3" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 9.586V6z" clip-rule="evenodd" />
            </svg>
            Time Limit: <span class="text-red-500 font-extrabold ml-1">40 Minutes</span>
        </p>
        <p class="text-md sm:text-lg font-medium pt-2 text-gray-600">Prepare yourself and good luck!</p>
    </div>

    <!-- FIX: Re-added onclick="startQuiz()" -->
    <button id="start-quiz-button" onclick="startQuiz()" class="px-12 py-4 sm:px-16 sm:py-5 bg-emerald-600 text-white text-xl sm:text-2xl font-bold rounded-xl shadow-xl hover:bg-emerald-700 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] focus:ring-4 focus:ring-emerald-300">
        Start Quiz
    </button>
    
    <!-- MODIFICATION: Added "Made by Shayan" text -->
    <footer class="text-center mt-10">
        <p class="text-sm font-semibold text-gray-600 mb-1">Made by Shayan</p>
        <p class="text-xs text-gray-400">Quiz content based on a 40-question ICT/Network Security syllabus.</p>
    </footer>
</div>

<!-- MAIN QUIZ CONTENT (Hidden until started) -->
<div id="main-quiz-container" class="flex flex-col flex-grow">

    <!-- Header (Title and Timer) -->
    <header class="text-center py-4 mb-6 bg-white shadow-xl rounded-2xl flex flex-col sm:flex-row justify-between items-center px-4 sm:px-8 border-b-4 border-indigo-500">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-800 mb-2 sm:mb-0">Network Security Mastery</h1>
        <div class="flex items-center space-x-3 p-2 rounded-lg bg-red-50 border border-red-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="timer-display" class="text-2xl sm:text-3xl font-black text-red-600">40:00</span>
        </div>
    </header>

    <!-- Progress Bar and Stats -->
    <div class="flex justify-between text-base sm:text-lg font-semibold text-gray-600 mb-2 px-2">
        <span id="question-index">Question 1 of 40</span>
        <span id="score-display" class="text-indigo-600">Score: 0</span>
    </div>
    <div id="progress-bar" class="w-full bg-gray-300 rounded-full h-3 mb-8 overflow-hidden">
        <div id="progress-fill" class="bg-indigo-600 h-3 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
    </div>

    <!-- Quiz Area -->
    <main id="quiz-area" class="bg-white p-6 sm:p-8 shadow-2xl rounded-3xl flex-grow border border-gray-100">
        <div class="text-center py-10"><p class="text-gray-500">Initializing quiz...</p></div>
    </main>

    <!-- Navigation Buttons -->
    <div id="navigation-area" class="mt-6 p-5 bg-white shadow-2xl rounded-2xl flex flex-col sm:flex-row justify-between gap-4 border-t-4 border-gray-200">
        <button id="prev-button" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-bold transition-colors hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
        <button id="next-button" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold transition-colors hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed">Next Question →</button>
    </div>
</div>

</div>

<script>
// --- QUIZ DATA (40 Questions from ICT/Network Security Document) ---
const quizData = [
    // 1. Network Devices (MAC address)
    { q: "Which network device uses Media Access Control (MAC) addresses to forward data frames to a specific destination port?", options: ["Hub", "Router", "Switch", "Repeater"], correct: "Switch" },
    // 2. Network Topology (Star Failure)
    { q: "In which network topology does the failure of the central hub or switch cause the entire network to stop functioning?", options: ["Bus Topology", "Ring Topology", "Star Topology", "Mesh Topology"], correct: "Star Topology" },
    // 3. Network Topology (Combining two or more)
    { q: "What is the term for a network structure combining two or more different standard topologies (Star, Ring, Bus)?", options: ["MAN", "Tree Topology", "Hybrid Topology", "LAN"], correct: "Hybrid Topology" },
    // 4. Network Type (LAN definition)
    { q: "A computer network established over a relatively small area, like within a single building or campus, is categorized as a:", options: ["WAN", "MAN", "LAN", "Intranet"], correct: "LAN" },
    // 5. Malware Type (Trojan Horse)
    { q: "Which type of malware disguises itself as useful software to trick users into running it and cause damage upon execution?", options: ["Computer Virus", "Worm", "Trojan Horse", "Rootkit"], correct: "Trojan Horse" },
    // 6. Security (Firewall)
    { q: "The security wall that monitors and filters incoming/outgoing network traffic based on predetermined security rules is called a:", options: ["Antivirus", "Proxy Server", "Firewall", "Router"], correct: "Firewall" },
    // 7. Security (CAPTCHA)
    { q: "What is the process to differentiate a human from a machine by requiring the user to type stylized characters or identify images?", options: ["Phishing", "Spam Filtering", "Captcha", "Digital Signature"], correct: "Captcha" },
    // 8. Server Definition
    { q: "A powerful computer that provides shared resources and services, such as file storage or printing, to client computers on a network is known as a:", options: ["Client", "Terminal", "Workstation", "Server"], correct: "Server" },
    // 9. Data Transmission (Fastest long-distance)
    { q: "For sending signals over the farthest corners of the world, which transmission medium is cited as highly effective?", options: ["Twisted Pair", "Coaxial Cable", "Optical Fibre", "Radio Waves"], correct: "Optical Fibre" },
    // 10. Resource Sharing (Cloud Computing Example)
    { q: "Using web-based services like Gmail or Yahoo for sending emails is a common example of utilizing services based on:", options: ["Peer-to-Peer Networking", "Cloud Computing", "Packet Switching", "Client-Server Architecture"], correct: "Cloud Computing" },
    // 11. Security Threat (Malware category)
    { q: "What is the collective term for programming codes or programs that disrupt the smooth function of software, including Viruses, Worms, and Trojan Horses?", options: ["Freeware", "Malware", "Firmware", "Shareware"], correct: "Malware" },
    // 12. Security (Authentication)
    { q: "A type of electronic signature used to authenticate the identity of the sender of a message or the signer of a document is called a:", options: ["Watermark", "Hash Code", "Digital Signature", "Token"], correct: "Digital Signature" },
    
    // --- New Questions 13-40 (Total 40) ---
    // 13. Network Type (WAN)
    { q: "A network spanning large geographical areas, often connecting multiple cities or countries, is categorized as a:", options: ["LAN", "MAN", "WAN", "PAN"], correct: "WAN" },
    // 14. Network Type (MAN)
    { q: "A network designed for a city or large campus, intermediate in size between a LAN and a WAN, is known as a:", options: ["LAN", "MAN", "WAN", "Intranet"], correct: "MAN" },
    // 15. Network Topology (Bus)
    { q: "Which topology connects all computers to a single central cable (backbone), where data is transmitted in both directions?", options: ["Star Topology", "Ring Topology", "Bus Topology", "Mesh Topology"], correct: "Bus Topology" },
    // 16. Network Topology (Ring)
    { q: "In which network topology is each node connected to exactly two other nodes, forming a single continuous data pathway?", options: ["Star Topology", "Ring Topology", "Bus Topology", "Tree Topology"], correct: "Ring Topology" },
    // 17. Network Topology (Mesh)
    { q: "What is the topology where every device is directly connected to every other device, offering high redundancy?", options: ["Star Topology", "Ring Topology", "Bus Topology", "Mesh Topology"], correct: "Mesh Topology" },
    // 18. Network Device (Router)
    { q: "Which device operates at the Network Layer (Layer 3) and uses IP addresses to connect different network segments?", options: ["Hub", "Switch", "Router", "Modem"], correct: "Router" },
    // 19. Network Device (Modem)
    { q: "What device converts digital signals from a computer into analog signals for transmission over phone lines (and vice versa)?", options: ["Router", "Switch", "Modem", "Repeater"], correct: "Modem" },
    // 20. Network Device (Repeater)
    { q: "A device used to boost or regenerate a signal to extend the maximum distance a data signal can travel is a:", options: ["Bridge", "Router", "Switch", "Repeater"], correct: "Repeater" },
    // 21. Internet Protocol (IP)
    { q: "Which fundamental protocol is responsible for addressing and routing data packets across the internet?", options: ["TCP", "HTTP", "IP", "FTP"], correct: "IP" },
    // 22. Internet Protocol (TCP)
    { q: "The protocol that ensures reliable, ordered, and error-checked delivery of a stream of bytes between applications is:", options: ["IP", "UDP", "HTTP", "TCP"], correct: "TCP" },
    // 23. Security Threat (Worm)
    { q: "A self-replicating program that spreads across networks by exploiting security vulnerabilities without requiring human interaction is a:", options: ["Computer Virus", "Trojan Horse", "Worm", "Spyware"], correct: "Worm" },
    // 24. Security Threat (Spyware)
    { q: "Software installed on a user's computer without their knowledge, often to secretly monitor their activities and gather data, is called:", options: ["Adware", "Ransomware", "Spyware", "Rootkit"], correct: "Spyware" },
    // 25. Security Threat (DoS)
    { q: "An attack that aims to make a machine or network resource unavailable to its intended users by temporarily or indefinitely disrupting services is known as a:", options: ["Phishing", "Firewall Attack", "Denial of Service (DoS)", "SQL Injection"], correct: "Denial of Service (DoS)" },
    // 26. Security Technique (Encryption)
    { q: "The process of converting readable data into an unreadable code (ciphertext) to prevent unauthorized access is called:", options: ["Decryption", "Hashing", "Encryption", "Authentication"], correct: "Encryption" },
    // 27. Security Technique (Authentication)
    { q: "What is the method of verifying the identity of a user, process, or device attempting to access a resource?", options: ["Authorization", "Encryption", "Authentication", "Digital Signature"], correct: "Authentication" },
    // 28. Security Technique (Authorization)
    { q: "The function of specifying access rights to resources, typically performed after a user has been authenticated, is called:", options: ["Encryption", "Authentication", "Authorization", "Hashing"], correct: "Authorization" },
    // 29. ICT Concept (Software Piracy)
    { q: "What is the term for the illegal copying, reproduction, or distribution of software applications for personal or business use?", options: ["Hacking", "Phishing", "Software Piracy", "Spamming"], correct: "Software Piracy" },
    // 30. ICT Concept (Computer Ethics)
    { q: "What body of moral principles or values governs the use of computers, networks, and information systems?", options: ["Cyber Law", "Digital Rights", "Computer Ethics", "Privacy Policy"], correct: "Computer Ethics" },
    // 31. ICT Concept (Spamming)
    { q: "The use of electronic messaging systems (like email) to send unsolicited bulk messages, typically advertising, is known as:", options: ["Phishing", "Pharming", "Spamming", "Spoofing"], correct: "Spamming" },
    // 32. Internet Service (DNS)
    { q: "The service that translates user-friendly domain names (e.g., example.com) into numerical IP addresses is the:", options: ["DHCP", "ARP", "DNS", "NAT"], correct: "DNS" },
    // 33. Internet Service (HTTPS)
    { q: "Which protocol is the secure version of the Hypertext Transfer Protocol, using SSL/TLS for encryption?", options: ["HTTP", "FTP", "SMTP", "HTTPS"], correct: "HTTPS" },
    // 34. Network Cable (Twisted Pair)
    { q: "What is the most common type of network cable, consisting of four pairs of copper wires twisted together to reduce electromagnetic interference?", options: ["Coaxial Cable", "Fiber Optic", "Ethernet Cable", "Twisted Pair Cable"], correct: "Twisted Pair Cable" },
    // 35. Network Device (Hub)
    { q: "A repeater with multiple ports that broadcasts data received on one port to all other ports in a network segment is a:", options: ["Switch", "Router", "Bridge", "Hub"], correct: "Hub" },
    // 36. Security Practice (MFA)
    { q: "Using multiple distinct forms of identity verification (e.g., password and a code from a mobile device) to log in is called:", options: ["Single Sign-On (SSO)", "Multi-Factor Authentication (MFA)", "Token Generation", "Biometrics"], correct: "Multi-Factor Authentication (MFA)" },
    // 37. Security Threat (Phishing)
    { q: "An attempt to acquire sensitive information (like usernames, passwords, and credit card details) by disguising as a trustworthy entity in an electronic communication is:", options: ["Spoofing", "Hacking", "Phishing", "Firewall Attack"], correct: "Phishing" },
    // 38. Data Unit (Packet)
    { q: "What is the basic unit of data transferred at the Network Layer (Layer 3) of the OSI model?", options: ["Frame", "Segment", "Bit", "Packet"], correct: "Packet" },
    // 39. Data Unit (Frame)
    { q: "What is the basic unit of data transferred at the Data Link Layer (Layer 2) of the OSI model?", options: ["Packet", "Segment", "Bit", "Frame"], correct: "Frame" },
    // 40. ICT Storage (Volatile)
    { q: "Which type of computer memory requires continuous power to maintain the stored data, losing its contents when power is removed?", options: ["ROM", "Hard Disk Drive", "Volatile Memory (RAM)", "SSD"], correct: "Volatile Memory (RAM)" },
];

// --- STATE VARIABLES ---
let currentQuestionIndex = 0;
let score = 0;
// Initialize userAnswers with null for all questions
const userAnswers = new Array(quizData.length).fill(null);
let isReviewMode = false;
let timerInterval;
// 40 minutes * 60 seconds/minute = 2400 seconds
let timeLeft = 40 * 60; 

// --- DOM REFERENCES ---
const welcomeScreen = document.getElementById('welcome-screen');
const mainQuizContainer = document.getElementById('main-quiz-container');
const quizArea = document.getElementById('quiz-area');
const questionIndexEl = document.getElementById('question-index');
const scoreDisplayEl = document.getElementById('score-display');
const prevButton = document.getElementById('prev-button');
const nextButton = document.getElementById('next-button');
const progressBarFill = document.getElementById('progress-fill');
const timerDisplay = document.getElementById('timer-display');


// --- TIMER FUNCTIONS ---

/**
 * Formats time from seconds into MM:SS string.
 * @param {number} seconds - The time remaining in seconds.
 * @returns {string} Formatted time string.
 */
function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    const paddedMinutes = String(minutes).padStart(2, '0');
    const paddedSeconds = String(remainingSeconds).padStart(2, '0');
    return `${paddedMinutes}:${paddedSeconds}`;
}

/**
 * Decrements the timer and handles expiration.
 */
function updateTimer() {
    timeLeft--;
    timerDisplay.textContent = formatTime(timeLeft);

    // Dynamic styling for low time remaining (last 5 minutes = 300 seconds)
    if (timeLeft <= 300 && !timerDisplay.classList.contains('text-red-700')) { 
        timerDisplay.classList.add('text-red-700', 'font-extrabold', 'animate-pulse');
        timerDisplay.classList.remove('text-red-600', 'font-black');
    }

    if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timeExpired();
    }
}

/**
 * Starts the quiz timer. Clears any existing interval first.
 */
function startTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    timerDisplay.textContent = formatTime(timeLeft); // Initial display
    timerInterval = setInterval(updateTimer, 1000);
}

/**
 * Handles the event when the quiz time runs out.
 */
function timeExpired() {
    clearInterval(timerInterval); // Stop timer
    showMessage("Time's Up! ⏱️", "The 40 minutes have expired. Your quiz has been automatically submitted to calculate your score.");
    // Force show results
    showResults(true);
}


// --- QUIZ NAVIGATION & LOGIC ---

/**
 * Initiates the quiz, hiding the welcome screen and starting the timer.
 */
function startQuiz() {
    welcomeScreen.style.display = 'none';
    mainQuizContainer.style.display = 'flex'; 
    startTimer(); 
    renderQuestion();
}

/**
 * Shows a custom, non-blocking modal message instead of alert().
 * @param {string} title - The modal title.
 * @param {string} message - The modal message content.
 */
function showMessage(title, message) {
    // Pause timer
    if (!isReviewMode) {
        clearInterval(timerInterval); 
    }
    
    const messageBox = document.createElement('div');
    messageBox.className = 'fixed inset-0 bg-gray-900 bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50 p-4';
    messageBox.innerHTML = `
    <div class="bg-white p-8 rounded-2xl shadow-3xl max-w-sm w-full transform transition-all duration-300 scale-100 border-t-4 border-indigo-600">
        <h3 class="text-2xl font-black mb-4 text-indigo-700">${title}</h3>
        <p class="text-gray-700 mb-6">${message}</p>
        <button onclick="closeMessage()" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors shadow-lg">
            I Understand
        </button>
    </div>
    `;
    document.body.appendChild(messageBox);
}

/**
 * Closes the custom modal and resumes the timer if in quiz mode.
 */
function closeMessage() {
    const messageBox = document.querySelector('.fixed.inset-0');
    if (messageBox) {
        messageBox.remove();
    }
    // Resume timer only if in quiz mode and the quiz is still running (not results screen)
    if (mainQuizContainer.style.display !== 'none' && !isReviewMode && timeLeft > 0) {
        startTimer(); 
    }
}


/**
 * Renders the current question and its options. Handles displaying answers in review mode.
 */
function renderQuestion() {
    const questionData = quizData[currentQuestionIndex];
    const userAnswer = userAnswers[currentQuestionIndex];

    if (!questionData) {
        quizArea.innerHTML = `<div class="text-center py-10"><p class="text-gray-500">Error loading question.</p></div>`;
        return;
    }

    // Update progress and navigation UI elements
    updateProgress();
    updateNavigationButtons(); 

    // Build the HTML content for the question
    let htmlContent = `
    <p class="text-xl sm:text-2xl font-extrabold mb-8 text-gray-800 leading-snug">
    <span class="text-indigo-600">${currentQuestionIndex + 1}.</span> ${questionData.q}
    </p>
    <div class="space-y-4">
    `;

    const optionLabels = ['A', 'B', 'C', 'D'];

    questionData.options.forEach((option, index) => {
        let classes = "option-button w-full text-left p-4 border-2 border-gray-300 rounded-xl font-medium text-gray-700";
        let onClick = `selectOption('${option.replace(/'/g, "\\'")}')`; // Sanitize option string for inline JS

        const isAnsweredOrReview = userAnswer !== null || isReviewMode;

        // Check if user has answered this question or is in review mode
        if (isAnsweredOrReview) {
            // Disable clicking
            onClick = '';
            classes += ' disabled';

            // Highlight correct/incorrect logic
            if (userAnswer === option) {
                if (option === questionData.correct) {
                    classes += ' correct';
                } else {
                    classes += ' incorrect';
                }
            } else if (option === questionData.correct) {
                // Always highlight the correct answer in review or once answered incorrectly
                classes += ' correct';
            }

        } else {
            // Unanswered, not in review: Default styling
            classes += ' hover:bg-indigo-50/50';
        }

        htmlContent += `
        <button
        class="${classes}"
        data-option="${option}"
        onclick="${onClick}"
        >
        <span class="font-bold mr-2 ${isAnsweredOrReview ? '' : 'text-indigo-600'}">${optionLabels[index]}.</span> ${option}
        </button>
        `;
    });

    htmlContent += `</div>`;

    // Show detailed feedback if in review mode
    if (isReviewMode) {
        const isCorrect = userAnswer === questionData.correct;
        const feedbackClass = isCorrect ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-red-500 bg-red-50 text-red-700';

        htmlContent += `
        <div class="mt-8 p-6 rounded-xl border-l-4 shadow-md ${feedbackClass}">
        <p class="font-bold text-lg mb-1">
        ${isCorrect ? '✅ Your Answer Was Correct!' : '❌ Your Answer Was Incorrect.'}
        </p>
        <p class="text-sm mt-2 text-gray-600">
        ${userAnswer ? `You chose: <span class="font-semibold text-gray-800">${userAnswer}</span>` : 'You left this question unanswered.'}
        </p>
        ${!isCorrect ? `<p class="text-sm mt-1 text-gray-600">The correct answer is: <span class="font-bold text-emerald-600">${questionData.correct}</span></p>` : ''}
        </div>
        `;
    }

    quizArea.innerHTML = htmlContent;
}

/**
 * Handles option selection and locks the question.
 * @param {string} selectedOption - The option text selected by the user.
 */
function selectOption(selectedOption) {
    // Only allow selection if not already answered and not in review mode
    if (userAnswers[currentQuestionIndex] === null && !isReviewMode) {
        userAnswers[currentQuestionIndex] = selectedOption;

        recalculateScore();
        renderQuestion();
        updateNavigationButtons();
    }
}

/**
 * Recalculates the score based on userAnswers vs quizData.
 */
function recalculateScore() {
    score = 0;
    quizData.forEach((question, index) => {
        if (userAnswers[index] === question.correct) {
            score++;
        }
    });
    scoreDisplayEl.textContent = `Score: ${score}`;
}

/**
 * Updates score display, question index, and the progress bar.
 */
function updateProgress() {
    const totalQuestions = quizData.length;
    const answeredQuestions = userAnswers.filter(a => a !== null).length;

    questionIndexEl.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;

    // Progress bar fills based on answered questions (quiz mode) or current index (review mode)
    const progressBasis = isReviewMode ? currentQuestionIndex + 1 : answeredQuestions;
    const progressPercentage = (progressBasis / totalQuestions) * 100;
    progressBarFill.style.width = `${progressPercentage}%`;
}

/**
 * Updates the state (disabled/text) of the navigation buttons.
 */
function updateNavigationButtons() {
    // Prev Button Logic
    prevButton.disabled = currentQuestionIndex === 0;
    
    if (isReviewMode) {
        nextButton.textContent = currentQuestionIndex === quizData.length - 1 ? 'End Review' : 'Next Question →';
        prevButton.textContent = '← Previous Question'; 
        nextButton.disabled = false;
    } else {
        prevButton.textContent = '← Previous'; 
        nextButton.textContent = currentQuestionIndex === quizData.length - 1 ? 'Finish & See Results' : 'Next Question →';
        // Disable 'Next' if not answered and not the last question
        nextButton.disabled = userAnswers[currentQuestionIndex] === null && currentQuestionIndex < quizData.length - 1;
    }
}

/**
 * Handles the "Next" button click, advancing the question or finishing the quiz/review.
 */
function handleNext() {
    if (currentQuestionIndex < quizData.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
    } else {
        // End of the list of questions
        if (isReviewMode) {
            // End of review mode
            isReviewMode = false;
            showResults();
        } else {
            // End of quiz mode
            showResults();
        }
    }
}

/**
 * Handles the "Previous" button click, moving back one question.
 */
function handlePrev() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
    }
}

/**
 * Generates and displays the final results screen.
 * @param {boolean} [timeExpired=false] - True if the submission was forced by the timer.
 */
function showResults(timeExpired = false) {
    clearInterval(timerInterval); // Stop timer
    recalculateScore();
    const totalQuestions = quizData.length;
    const percentage = ((score / totalQuestions) * 100).toFixed(1);
    const answeredCount = userAnswers.filter(a => a !== null).length;
    const unansweredCount = totalQuestions - answeredCount;

    let resultMessage;
    let resultColor;
    let icon;

    if (percentage >= 80) {
        resultMessage = "Outstanding! You have an excellent grasp of the material.";
        resultColor = 'text-emerald-700 bg-emerald-100 border-emerald-400';
        icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-emerald-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
    } else if (percentage >= 60) {
        resultMessage = "Great job! You passed, but review the topics you missed.";
        resultColor = 'text-yellow-700 bg-yellow-100 border-yellow-400';
        icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.332 16c-.77 1.333.192 3 1.732 3z" /></svg>`;
    } else {
        resultMessage = "Keep studying! Review the course material and try again.";
        resultColor = 'text-red-700 bg-red-100 border-red-400';
        icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-red-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
    }

    quizArea.innerHTML = `
    <div class="text-center py-10">
    <h2 class="text-4xl sm:text-5xl font-extrabold text-indigo-600 mb-2">${timeExpired ? 'Submission Forced!' : 'Quiz Complete!'}</h2>
    <p class="text-xl text-gray-500 mb-8">${answeredCount} questions were answered out of ${totalQuestions}.</p>
    
    <div class="inline-block p-10 rounded-full border-4 ${resultColor} shadow-xl mb-8">
        ${icon}
        <p class="text-5xl sm:text-7xl font-black mt-2">${percentage}%</p>
    </div>

    <p class="text-xl mt-6 text-gray-700 font-semibold">${resultMessage}</p>

    <!-- Detailed Stats Grid -->
    <div class="grid grid-cols-3 gap-4 mt-10 text-md font-bold max-w-lg mx-auto">
    <div class="p-4 bg-emerald-50 rounded-xl text-emerald-800 border border-emerald-200 shadow-md">
    <p class="font-black text-3xl">${score}</p>
    <p class="mt-1">Correct</p>
    </div>
    <div class="p-4 bg-red-50 rounded-xl text-red-800 border border-red-200 shadow-md">
    <p class="font-black text-3xl">${totalQuestions - score}</p>
    <p class="mt-1">Incorrect</p>
    </div>
    <div class="p-4 bg-gray-50 rounded-xl text-gray-800 border border-gray-200 shadow-md">
    <p class="font-black text-3xl">${unansweredCount}</p>
    <p class="mt-1">Skipped</p>
    </div>
    </div>

    </div>
    `;

    // Update navigation for results screen
    prevButton.textContent = 'Review Answers';
    prevButton.disabled = false;
    nextButton.textContent = 'Start New Quiz';
    nextButton.disabled = false;

    // Update progress bar to 100% completion
    progressBarFill.style.width = '100%';

    // Reassign click handlers for results buttons
    prevButton.onclick = startReview;
    nextButton.onclick = resetQuiz;
}

/**
 * Initiates the review mode to allow users to see correct answers.
 */
function startReview() {
    isReviewMode = true;
    currentQuestionIndex = 0;
    
    // Set the navigation handlers back to handlePrev/handleNext for question navigation
    prevButton.onclick = handlePrev;
    nextButton.onclick = handleNext;
    
    // Hide timer in review mode
    const timerParent = document.getElementById('timer-display').parentNode;
    if (timerParent) timerParent.style.display = 'none';
    
    renderQuestion();
}

/**
 * Resets the entire quiz state and returns to the welcome screen.
 */
function resetQuiz() {
    clearInterval(timerInterval); 
    
    // Reset state
    currentQuestionIndex = 0;
    score = 0;
    userAnswers.fill(null);
    isReviewMode = false;
    timeLeft = 40 * 60; // Reset to 40 minutes

    // Reset timer display state if it was red
    timerDisplay.classList.remove('text-red-700', 'font-extrabold', 'animate-pulse');
    timerDisplay.classList.add('text-red-600', 'font-black');
    
    // Reset UI to welcome screen
    mainQuizContainer.style.display = 'none';
    welcomeScreen.style.display = 'flex';
    
    // Show timer again
    const timerParent = document.getElementById('timer-display').parentNode;
    if (timerParent) timerParent.style.display = 'flex';
    
    // Re-attach original handlers
    prevButton.onclick = handlePrev;
    nextButton.onclick = handleNext;
    
    // Reset button text to default 
    prevButton.textContent = '← Previous';
    nextButton.textContent = 'Next Question →';
}

// --- EVENT LISTENERS (Standard Quiz Navigation) ---

// Attach event listeners for navigation buttons
nextButton.addEventListener('click', handleNext);
prevButton.addEventListener('click', handlePrev);

// Removed redundant start-quiz-button listener since onclick is now in HTML
// document.getElementById('start-quiz-button').addEventListener('click', startQuiz); 

</script>

</body>
</html>