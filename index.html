<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Science 50-Question MCQ Quiz</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
font-family: 'Inter', sans-serif;
background-color: #f7fafc;
}
/* Ensure the quiz container itself is responsive and centered */
.quiz-container {
max-width: 768px; /* Standard maximum width for large screens */
margin: auto;
min-height: 100vh;
display: flex;
flex-direction: column;
padding: 1rem;
}

/* --- ANIMATION & CUSTOM BUTTON STYLES --- */

/* Base transition for all interactive buttons (Navigation, Start) */
#start-quiz-button, #prev-button, #next-button {
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateZ(0); /* Hardware acceleration */
}

/* Press-down/click animation for the main action buttons */
#start-quiz-button:active:not(:disabled),
#next-button:active:not(:disabled) {
    transform: scale(0.98);
    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); /* Remove shadow on press */
}

#prev-button:active:not(:disabled) {
    transform: scale(0.98);
}


/* Enhanced Option Button Styles (for the quiz choices) */
.option-button {
    transition: all 0.15s ease-out; /* Snappy transition */
    cursor: pointer;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
    white-space: normal;
    height: auto;
    transform: translateZ(0);
}

.option-button:hover:not(.disabled) {
    background-color: #f3f4f6; /* Subtle hover effect */
    transform: translateY(-2px); /* Lift effect on hover */
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
}

.option-button:active:not(.disabled) {
    transform: scale(0.99); /* Slight press effect */
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* Minimal shadow on press */
    background-color: #e5e7eb; /* Subtle press background */
}

/* Visual feedback for correct/incorrect answers */
.correct {
    background-color: #10b981 !important; /* Green 500 */
    color: white !important;
    border-color: #059669 !important; /* Green 600 */
    font-weight: 600;
}
.incorrect {
    background-color: #ef4444 !important; /* Red 500 */
    color: white !important;
    border-color: #dc2626 !important; /* Red 600 */
    font-weight: 600;
}
.disabled {
    pointer-events: none;
    opacity: 0.7; /* Increased opacity for visibility */
    box-shadow: none;
}
/* Hide the main quiz content initially */
#main-quiz-container {
    display: none;
}
/* Ensure the welcome screen content stays centered and fits */
#welcome-screen {
    max-width: 100%;
}
</style>
</head>
<body>

<div class="quiz-container">

<!-- WELCOME SCREEN -->
<div id="welcome-screen" class="bg-white p-6 sm:p-10 shadow-2xl rounded-2xl flex-grow flex flex-col justify-center items-center text-center">
    <h1 class="text-3xl sm:text-5xl font-extrabold text-indigo-700 mb-6">ðŸ‘‹ Welcome to the Science Quiz!</h1>
    
    <div class="space-y-4 text-gray-700 max-w-sm mx-auto mb-10 p-6 bg-indigo-50 rounded-xl border border-indigo-200">
        <p class="text-xl sm:text-2xl font-semibold">You have to answer <span class="text-indigo-600">50 questions</span>.</p>
        <p class="text-xl sm:text-2xl font-semibold">The time limit is <span class="text-red-500">50 minutes</span>.</p>
        <p class="text-md sm:text-lg font-medium mt-4">Good luck! No cheating.</p>
    </div>

    <button id="start-quiz-button" onclick="startQuiz()" class="px-8 py-3 sm:px-10 sm:py-4 bg-green-600 text-white text-lg sm:text-xl font-bold rounded-lg shadow-lg hover:bg-green-700 transition-colors transform hover:scale-105">
        Start Quiz
    </button>
    
    <!-- Credit Line for Welcome Screen -->
    <footer class="text-xs text-gray-400 mt-6">Made by Shayan</footer>
</div>

<!-- MAIN QUIZ CONTENT (Hidden until started) -->
<div id="main-quiz-container" class="flex flex-col flex-grow">

    <!-- Header (Fix Applied: Ensures horizontal alignment of title and timer, and adapts font size) -->
    <header class="text-center py-3 mb-4 bg-white shadow-xl rounded-xl flex flex-col sm:flex-row justify-between items-center px-4 sm:px-6">
        <h1 class="text-xl sm:text-2xl font-bold text-gray-800 mb-2 sm:mb-0">Science Quiz</h1>
        <div class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="timer-display" class="text-xl sm:text-2xl font-extrabold text-red-600">50:00</span>
        </div>
    </header>

    <!-- Progress and Score -->
    <div id="progress-bar" class="w-full bg-gray-300 rounded-full h-3 mb-4 overflow-hidden">
    <div id="progress-fill" class="bg-indigo-600 h-3 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
    </div>
    <div class="flex justify-between text-base sm:text-lg font-semibold text-gray-700 mb-6 px-2">
    <span id="question-index">Question 1 of 50</span>
    <span id="score-display">Score: 0</span>
    </div>

    <!-- Quiz Area -->
    <main id="quiz-area" class="bg-white p-4 sm:p-6 shadow-2xl rounded-2xl flex-grow border border-gray-100">
    <!-- Question and Options will be injected here -->
    </main>

    <!-- Navigation Buttons -->
    <div id="navigation-area" class="mt-6 p-4 bg-white shadow-xl rounded-xl flex flex-col sm:flex-row justify-between gap-4">
    <button id="prev-button" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-semibold transition-colors hover:bg-gray-400 disabled:opacity-50">Previous</button>
    <button id="next-button" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold transition-colors hover:bg-indigo-700 disabled:opacity-50">Next Question</button>
    </div>
    
    <!-- Credit Line for Quiz Screen -->
    <footer class="text-xs text-gray-400 text-center mt-3">Made by Shayan</footer>
</div>

</div>

<script>
// --- QUIZ DATA (50 Questions) ---
const quizData = [
// Chapter 4: Reproduction in Plants (8 Qs)
{ q: "Which part of a seed is responsible for developing into the shoot of the new plant?", options: ["Radicle", "Plumule", "Cotyledon", "Seed coat"], correct: "Plumule" },
{ q: "Which of the following is an example of an underground modified stem that helps in vegetative reproduction?", options: ["Sweet potato", "Ginger (Rhizome)", "Onion (Bulb)", "Dahlia (Tuber)"], correct: "Ginger (Rhizome)" },
{ q: "What is the process of joining parts of two plants so they grow as one known as?", options: ["Cutting", "Layering", "Budding", "Grafting"], correct: "Grafting" },
{ q: "Which fruit is cited as developing only from the ovary and thus classified as a 'true fruit'?", options: ["Apple", "Custard apple", "Mango", "Jackfruit"], correct: "Mango" },
{ q: "The essential whorls of a flower are the androecium and which other part?", options: ["Calyx", "Corolla", "Gynoecium (Pistil)", "Receptacle"], correct: "Gynoecium (Pistil)" },
{ q: "What is the term for the type of germination where the cotyledons remain under the soil (e.g., Gram)?", options: ["Epigeal", "Hypogeal", "Semi-epigeal", "Aerial"], correct: "Hypogeal" },
{ q: "The gaseous phytohormone primarily responsible for fruit ripening is:", options: ["Auxin", "Gibberellin", "Cytokinin", "Ethylene"], correct: "Ethylene" },
{ q: "The movement of a plant part towards the direction of light is called:", options: ["Geotropism", "Hydrotropism", "Phototropism", "Thigmotropism"], correct: "Phototropism" },

// Chapter 5: Co-ordination and Secretion (8 Qs)
{ q: "The structural and functional unit of the nervous system is the:", options: ["Nephron", "Alveolus", "Neurone (Nerve cell)", "Myofibril"], correct: "Neurone (Nerve cell)" },
{ q: "The plant hormone first discovered by Charles Darwin is:", options: ["Gibberellin", "Auxin", "Cytokinin", "Abscisic Acid"], correct: "Auxin" },
{ q: "What is the term for the minute gap or junction between the axon end of one neurone and the dendrite of the next?", options: ["Cell body", "Dendrite", "Node of Ranvier", "Synapse"], correct: "Synapse" },
{ q: "Which part of the human brain controls vital involuntary actions such as breathing and heartbeat?", options: ["Cerebrum", "Cerebellum", "Pons", "Medulla oblongata"], correct: "Medulla oblongata" },
{ q: "What is the primary function controlled by the largest part of the brain, the Cerebrum?", options: ["Balancing body posture", "Controlling heart rate", "Thinking, memory, vision", "Regulating sleep cycles"], correct: "Thinking, memory, vision" },
{ q: "Which organ is cited as the **main** excretory organ, eliminating about 80% of nitrogenous waste?", options: ["Lung", "Skin", "Kidney", "Liver"], correct: "Kidney" },
{ q: "The nitrogenous waste product eliminated by the kidney as the primary component of urine is:", options: ["Urea", "Carbon dioxide", "Salt", "Sweat"], correct: "Urea" },
{ q: "What is a chemical compound that regulates physiological activities in plants called?", options: ["Enzyme", "Vitamin", "Phytohormone", "Toxin"], correct: "Phytohormone" },

// Chapter 10: Acid, Base and Salt (9 Qs)
{ q: "Which ion must an acidic substance produce when dissolved in water?", options: ["Hydroxide ion ($\text{OH}^-$)", "Sodium ion ($\text{Na}^+$)", "Sulphate ion ($\text{SO}_4^{2-}$)", "Hydrogen ion ($\text{H}^+$)"], correct: "Hydrogen ion ($\text{H}^+$)" },
{ q: "A characteristic property of a base is that it turns:", options: ["Blue litmus paper red", "Red litmus paper blue", "Phynophthylene colorless", "Methyl orange red"], correct: "Red litmus paper blue" },
{ q: "What is the definition of an **alkali** according to the document?", options: ["A base that is concentrated", "A base that dissolves in water", "A weak organic base", "Any substance that tastes bitter"], correct: "A base that dissolves in water" },
{ q: "Which gas is produced when a reactive metal like Zinc ($\text{Zn}$) reacts with Sulphuric Acid ($\text{H}_2\text{SO}_4$)?", options: ["Oxygen ($\text{O}_2$)", "Carbon Dioxide ($\text{CO}_2$)", "Sulphur Dioxide ($\text{SO}_2$)", "Hydrogen ($\text{H}_2$)"], correct: "Hydrogen ($\text{H}_2$)" },
{ q: "The reaction between Calcium Hydroxide ($\text{Ca}(\text{OH})_2$) and Sulphuric Acid ($\text{H}_2\text{SO}_4$) primarily produces salt and:", options: ["Metal", "Gas", "Acid", "Water"], correct: "Water" },
{ q: "Which of the following common substances is an example of an **organic acid**?", options: ["Sulphuric acid", "Hydrochloric acid", "Citric acid (in lemon)", "Nitric acid"], correct: "Citric acid (in lemon)" },
{ q: "The reaction between an acid and a carbonate ($\text{CaCO}_3$) produces salt, water, and which gas?", options: ["Oxygen", "Carbon Dioxide", "Hydrogen", "Nitrogen"], correct: "Carbon Dioxide" },
{ q: "If a base is added to an indicator called **Phynophthylene**, the color changes to:", options: ["Blue", "Red", "Pink/Reddish Purple", "Green"], correct: "Pink/Reddish Purple" },
{ q: "Mineral acids are generally considered more harmful than organic acids because:", options: ["They contain carbon", "They are insoluble in water", "They are highly corrosive and strong", "They are found only in minerals"], correct: "They are highly corrosive and strong" },

// Chapter 11: Light (9 Qs)
{ q: "What phenomenon explains why a pencil partially submerged in water appears broken or bent?", options: ["Total Internal Reflection", "Dispersion", "Refraction of light", "Diffraction"], correct: "Refraction of light" },
{ q: "When light passes from an optically **denser** medium to a **rarer** medium, the light ray bends:", options: ["Towards the normal", "Away from the normal", "Parallel to the surface", "Without bending"], correct: "Away from the normal" },
{ q: "The critical angle is the angle of incidence at which the angle of refraction is exactly:", options: ["45 degrees", "90 degrees", "180 degrees", "0 degrees"], correct: "90 degrees" },
{ q: "Which principle is utilized in the transmission of signals through **Optical Fibre**?", options: ["Refraction only", "Reflection only", "Total Internal Reflection (TIR)", "Polarization"], correct: "Total Internal Reflection (TIR)" },
{ q: "A simple magnifying glass uses which type of lens to form a virtual, upright, and magnified image?", options: ["Concave lens", "Plano-concave lens", "Concave mirror", "Convex lens"], correct: "Convex lens" },
{ q: "The image formed on the **retina** of a normal human eye is always:", options: ["Virtual, upright, magnified", "Real, upright, reduced", "Real, inverted, reduced", "Virtual, inverted, magnified"], correct: "Real, inverted, reduced" },
{ q: "For Total Internal Reflection to occur, light must travel from which combination of media?", options: ["Rarer to Denser", "Denser to Rarer", "Vacuum to Air", "Same density media"], correct: "Denser to Rarer" },
{ q: "When light undergoes refraction, which property is primarily responsible for the bending of the light ray?", options: ["Change in color", "Change in speed", "Change in frequency", "Change in amplitude"], correct: "Change in speed" },
{ q: "In the context of the human eye, which part functions analogously to the aperture of a camera?", options: ["Retina", "Lens", "Iris", "Optic nerve"], correct: "Iris" },

// Chapter 12: The Outer Space and Satellites (8 Qs)
{ q: "According to the Big Bang theory, approximately how many years ago did the universe begin?", options: ["4.5 billion years", "13.75 billion years", "25 billion years", "100 million years"], correct: "13.75 billion years" },
{ q: "The Outer Space is considered to begin at an altitude of about how many kilometers above the Earth's surface?", options: ["10 km", "60 km", "160 km", "500 km"], correct: "160 km" },
{ q: "What is the minimum speed required for an artificial satellite to maintain orbit around the Earth (approximately)?", options: ["1 km/s", "8 km/s", "15 km/s", "25 km/s"], correct: "8 km/s" },
{ q: "The stability of an orbiting satellite is a balance between its centrifugal acceleration and which other force?", options: ["Electromagnetic force", "Air resistance", "Gravitational force", "Thrust"], correct: "Gravitational force" },
{ q: "How many major planets revolve around the Sun in our Solar System?", options: ["7", "8", "9", "10"], correct: "8" },
{ q: "What was the name of the first artificial satellite launched into space?", options: ["Vostok 1", "Explorer 1", "Sputnik 1", "Venera 7"], correct: "Sputnik 1" },
{ q: "A primary example of a **natural satellite** is:", options: ["Jupiter", "The Moon", "Asteroid belt", "The Sun"], correct: "The Moon" },
{ q: "A satellite designed to stay positioned over the same spot on Earth's equator is best used for:", options: ["Weather forecasting", "Earth observation", "Deep space exploration", "Communication and broadcasting"], correct: "Communication and broadcasting" },

// Chapter 14: Environment and Ecosystem (8 Qs)
{ q: "In an ecosystem, which component is responsible for manufacturing food using solar energy?", options: ["Primary Consumers", "Secondary Consumers", "Decomposers", "Producers (Green Plants)"], correct: "Producers (Green Plants)" },
{ q: "What term describes the flow of **energy** through an ecosystem?", options: ["Cyclic", "Circular", "Linear (one-way)", "Biogeochemical"], correct: "Linear (one-way)" },
{ q: "Which organisms are classified as **Decomposers** in an ecosystem?", options: ["Herbivores and Carnivores", "Green plants and algae", "Fungi and Bacteria", "Snakes and Eagles"], correct: "Fungi and Bacteria" },
{ q: "A complex network formed by the interconnection of numerous food chains is called a:", options: ["Biogeochemical cycle", "Energy pyramid", "Food Web", "Biotope"], correct: "Food Web" },
{ q: "An organism that feeds directly on a Primary Consumer is classified as a:", options: ["Producer", "Tertiary Consumer", "Secondary Consumer", "Herbivore"], correct: "Secondary Consumer" },
{ q: "Which of the following is considered an **abiotic** component of an ecosystem?", options: ["Bacteria", "Minerals (Soil/Water)", "Fungi", "Insects"], correct: "Minerals (Soil/Water)" },
{ q: "The movement of **nutritive substances** (matter) through an ecosystem is best described as:", options: ["Linear", "Explosive", "Exponential", "Circular"], correct: "Circular" },
{ q: "What is the entire self-regulating system of biotic and abiotic components in a specific environment called?", options: ["Biome", "Biosphere", "Population", "Ecosystem"], correct: "Ecosystem" }
];

// --- STATE VARIABLES ---
let currentQuestionIndex = 0;
let score = 0;
const userAnswers = new Array(quizData.length).fill(null);
let isReviewMode = false;
let timerInterval;
// 50 minutes * 60 seconds/minute = 3000 seconds
let timeLeft = 50 * 60; 

// --- DOM REFERENCES ---
const welcomeScreen = document.getElementById('welcome-screen');
const mainQuizContainer = document.getElementById('main-quiz-container');
const quizArea = document.getElementById('quiz-area');
const questionIndexEl = document.getElementById('question-index');
const scoreDisplayEl = document.getElementById('score-display');
const prevButton = document.getElementById('prev-button');
const nextButton = document.getElementById('next-button');
const progressBarFill = document.getElementById('progress-fill');
const timerDisplay = document.getElementById('timer-display');


// --- TIMER FUNCTIONS ---

function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    const paddedMinutes = String(minutes).padStart(2, '0');
    const paddedSeconds = String(remainingSeconds).padStart(2, '0');
    return `${paddedMinutes}:${paddedSeconds}`;
}

function updateTimer() {
    timeLeft--;
    timerDisplay.textContent = formatTime(timeLeft);

    if (timeLeft <= 300) { // Highlight red when 5 minutes left
        timerDisplay.classList.add('text-red-700');
        timerDisplay.classList.remove('text-red-600');
    }

    if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timeExpired();
    }
}

function startTimer() {
    // FIX: Clear any existing interval before starting a new one
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    timerDisplay.textContent = formatTime(timeLeft); // Initial display
    timerInterval = setInterval(updateTimer, 1000);
}

function timeExpired() {
    clearInterval(timerInterval); // Stop timer
    showMessage("Time's Up! â±ï¸", "The 50 minutes have expired. Your quiz has been automatically submitted.");
    // Force show results without navigation
    showResults(true);
}


// --- QUIZ NAVIGATION & LOGIC ---

// Function to start the quiz
function startQuiz() {
    welcomeScreen.style.display = 'none';
    mainQuizContainer.style.display = 'flex'; // Changed to flex to honor the flex-grow class
    startTimer(); // Start the timer here
    renderQuestion();
}

// Function to show a custom message/modal instead of alert()
function showMessage(title, message) {
    clearInterval(timerInterval); // PAUSE TIMER
    const messageBox = document.createElement('div');
    messageBox.className = 'fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4';
    messageBox.innerHTML = `
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100">
        <h3 class="text-xl font-bold mb-3 text-indigo-700">${title}</h3>
        <p class="text-gray-700 mb-4">${message}</p>
        <button onclick="closeMessage()" class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors">
            Continue
        </button>
    </div>
    `;
    document.body.appendChild(messageBox);
}

function closeMessage() {
    const messageBox = document.querySelector('.fixed.inset-0');
    if (messageBox) {
        messageBox.remove();
    }
    // Resume timer only if not in results screen
    if (mainQuizContainer.style.display !== 'none' && !isReviewMode) {
        startTimer(); // RESTART TIMER
    }
}


// Renders the current question based on currentQuestionIndex
function renderQuestion() {
    // Check if the quiz is being rendered for the first time
    if (!quizData[currentQuestionIndex]) {
        quizArea.innerHTML = `<div class="text-center py-10"><p class="text-gray-500">Initializing quiz...</p></div>`;
        return;
    }

    const questionData = quizData[currentQuestionIndex];
    const userAnswer = userAnswers[currentQuestionIndex];

    // Update progress and navigation
    updateProgress();
    updateNavigationButtons(); // Ensure buttons are updated every time a new question loads

    // Build the HTML content for the question
    let htmlContent = `
    <p class="text-lg sm:text-xl font-bold mb-6 text-gray-800">
    ${currentQuestionIndex + 1}. ${questionData.q}
    </p>
    <div class="space-y-3">
    `;

    const optionLabels = ['A', 'B', 'C', 'D'];

    questionData.options.forEach((option, index) => {
        let classes = "option-button w-full text-left p-4 border-2 border-gray-300 rounded-lg shadow-sm font-medium text-gray-700";
        let onClick = `selectOption('${option}')`;

        // Check if user has answered this question
        if (userAnswer || isReviewMode) {
            // Disable clicking once answered/in review
            onClick = '';
            classes += ' disabled';

            // Highlight correct/incorrect logic
            if (userAnswer === option) {
                if (option === questionData.correct) {
                    classes += ' correct';
                } else {
                    classes += ' incorrect';
                }
            } else if (option === questionData.correct && (userAnswer || isReviewMode)) {
                // Highlight correct answer if incorrect choice was made OR if in review mode
                classes += ' correct';
            }

        }

        htmlContent += `
        <button
        class="${classes}"
        data-option="${option}"
        onclick="${onClick}"
        >
        <span class="text-indigo-600 mr-2">${optionLabels[index]}.</span> ${option}
        ${isReviewMode && option === questionData.correct ? ' (Correct Answer)' : ''} 
        </button>
        `;
    });

    htmlContent += `</div>`;

    // Show feedback if in review mode
    if (isReviewMode && userAnswer) {
        htmlContent += `
        <div class="mt-8 p-4 rounded-xl border-l-4 ${userAnswer === questionData.correct ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}">
        <p class="font-bold ${userAnswer === questionData.correct ? 'text-green-700' : 'text-red-700'}">
        ${userAnswer === questionData.correct ? 'Answer: Correct! ðŸŽ‰' : 'Answer: Incorrect ðŸ˜”'}
        </p>
        ${userAnswer !== questionData.correct ? `<p class="text-sm mt-1 text-gray-600">The correct answer was: <span class="font-semibold text-green-600">${questionData.correct}</span></p>` : ''}
        </div>
        `;
    }

    quizArea.innerHTML = htmlContent;
}

// Handles option selection
function selectOption(selectedOption) {
    if (userAnswers[currentQuestionIndex] === null && !isReviewMode) {
        userAnswers[currentQuestionIndex] = selectedOption;

        // Recalculate score immediately
        recalculateScore();

        // Re-render the question to show the correct/incorrect feedback
        renderQuestion();

        // Allow next button to be clicked immediately
        updateNavigationButtons();
    }
}

function recalculateScore() {
    score = 0;
    quizData.forEach((question, index) => {
        if (userAnswers[index] === question.correct) {
            score++;
        }
    });
}

// Updates score, question index, and progress bar
function updateProgress() {
    const totalQuestions = quizData.length;
    const answeredQuestions = userAnswers.filter(a => a !== null).length;

    questionIndexEl.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
    scoreDisplayEl.textContent = `Score: ${score}`;

    // Progress bar fills based on the current question index in review, or answered questions in quiz mode
    const progressBasis = isReviewMode ? currentQuestionIndex + 1 : answeredQuestions;
    const progressPercentage = (progressBasis / totalQuestions) * 100;
    progressBarFill.style.width = `${progressPercentage}%`;
}

// Updates the state of the navigation buttons
function updateNavigationButtons() {
    // Prev Button Logic
    prevButton.disabled = currentQuestionIndex === 0;
    
    // Set button text correctly based on review mode status
    if (isReviewMode) {
        prevButton.textContent = 'Previous Question'; 
        nextButton.textContent = currentQuestionIndex === quizData.length - 1 ? 'End Review' : 'Next Question';
        nextButton.disabled = false;
    } else {
        prevButton.textContent = 'Previous'; // Back to standard text in quiz mode
        nextButton.textContent = currentQuestionIndex === quizData.length - 1 ? 'Finish & See Results' : 'Next Question';
        // Disable next if the current question hasn't been answered yet, unless it's the very last question (where 'Finish' is the action)
        nextButton.disabled = userAnswers[currentQuestionIndex] === null && currentQuestionIndex < quizData.length - 1;
    }
}

// Handles the "Next" button click
function handleNext() {
    if (currentQuestionIndex < quizData.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
    } else {
        // End of the list of questions
        if (isReviewMode) {
            // End of review mode
            isReviewMode = false;
            showResults();
        } else {
            // End of quiz mode
            showResults();
        }
    }
}

// Handles the "Previous" button click
function handlePrev() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
    }
}

// Shows the final results screen
function showResults(timeExpired = false) {
    clearInterval(timerInterval); // Stop timer when results are shown
    recalculateScore();
    const totalQuestions = quizData.length;
    const percentage = ((score / totalQuestions) * 100).toFixed(1);
    const answeredCount = userAnswers.filter(a => a !== null).length;
    const unansweredCount = totalQuestions - answeredCount;

    let resultMessage;
    let resultColor;
    if (percentage >= 80) {
        resultMessage = "Outstanding! You have an excellent grasp of the material.";
        resultColor = 'text-green-600 bg-green-100 border-green-300';
    } else if (percentage >= 60) {
        resultMessage = "Great job! You passed, but review the topics you missed.";
        resultColor = 'text-yellow-600 bg-yellow-100 border-yellow-300';
    } else {
        resultMessage = "Keep studying! Review the course material and try again.";
        resultColor = 'text-red-600 bg-red-100 border-red-300';
    }

    quizArea.innerHTML = `
    <div class="text-center py-10">
    <h2 class="text-4xl font-extrabold text-indigo-600 mb-6">${timeExpired ? 'Submission Forced!' : 'Quiz Complete!'}</h2>
    <p class="text-xl text-gray-700 mb-2">You answered ${answeredCount} of ${totalQuestions} questions.</p>
    <div class="inline-block p-8 rounded-full border-4 ${resultColor} shadow-lg mb-8">
    <p class="text-7xl font-black">${percentage}%</p>
    </div>

    <p class="text-xl mt-6 text-gray-700 font-medium">${resultMessage}</p>

    <div class="grid grid-cols-3 gap-4 mt-8 text-md font-medium">
    <div class="p-4 bg-indigo-50 rounded-lg text-indigo-800 border border-indigo-200">
    <p class="font-bold text-2xl">${score}</p>
    <p class="mt-1">Correct</p>
    </div>
    <div class="p-4 bg-red-50 rounded-lg text-red-800 border border-red-200">
    <p class="font-bold text-2xl">${totalQuestions - score}</p>
    <p class="mt-1">Incorrect</p>
    </div>
    <div class="p-4 bg-gray-50 rounded-lg text-gray-800 border border-gray-200">
    <p class="font-bold text-2xl">${unansweredCount}</p>
    <p class="mt-1">Unanswered</p>
    </div>
    </div>

    </div>
    `;

    // Update navigation for results screen
    // IMPORTANT: Set the PREV button text to initiate the review mode.
    prevButton.textContent = 'Review Answers';
    prevButton.disabled = false;
    nextButton.textContent = 'Start New Quiz';
    nextButton.disabled = false;

    // Update progress bar to 100% completion
    progressBarFill.style.width = '100%';

    // Reassign click handlers for results buttons
    prevButton.onclick = startReview;
    nextButton.onclick = resetQuiz;
}

// Function to start the review mode
function startReview() {
    isReviewMode = true;
    currentQuestionIndex = 0;
    
    // Set the navigation handlers back to handlePrev/handleNext for question navigation
    prevButton.onclick = handlePrev;
    nextButton.onclick = handleNext;
    
    // Hide timer and update header for review mode
    document.getElementById('timer-display').parentNode.style.display = 'none';
    
    renderQuestion();
}

// Function to reset the quiz
function resetQuiz() {
    clearInterval(timerInterval); // Stop any running timer
    
    // Reset state
    currentQuestionIndex = 0;
    score = 0;
    userAnswers.fill(null);
    isReviewMode = false;
    timeLeft = 50 * 60; // Reset timer to 50 minutes

    // Reset UI to welcome screen
    mainQuizContainer.style.display = 'none';
    welcomeScreen.style.display = 'flex';
    document.getElementById('timer-display').parentNode.style.display = 'flex';
    
    // Re-attach original handlers
    prevButton.onclick = handlePrev;
    nextButton.onclick = handleNext;
    
    // Reset button text to default before the quiz starts
    prevButton.textContent = 'Previous';
    nextButton.textContent = 'Next Question';
}

// --- EVENT LISTENERS ---
nextButton.addEventListener('click', handleNext);
prevButton.addEventListener('click', handlePrev);
document.getElementById('start-quiz-button').addEventListener('click', startQuiz);

// --- INITIALIZATION ---
// No initial render needed since we start on the welcome screen.

</script>

</body>
</html>